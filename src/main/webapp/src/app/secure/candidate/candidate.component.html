<div class="container-fluid">

  <div class="row no-gutters">

    <div class="col-sm-2">
      <div class="inner-menu">
        <mat-nav-list>
          <a mat-list-item [ngClass]="{'mat-list-item-focus': selectedFilter == 'PENDING'}" (click)="applyFilterByState('PENDING')">
            <h4 mat-line>فعال</h4>
          </a>
          <a mat-list-item [ngClass]="{'mat-list-item-focus': selectedFilter == 'REJECTED'}" (click)="applyFilterByState('REJECTED')">
            <h4 mat-line>رد شده</h4>
          </a>
          <a mat-list-item [ngClass]="{'mat-list-item-focus': selectedFilter == 'ACCEPTED'}" (click)="applyFilterByState('ACCEPTED')">
            <h4 mat-line>استخدام شده</h4>
          </a>
          <a mat-list-item [ngClass]="{'mat-list-item-focus': selectedFilter == 'ALL'}"  (click)="loadAll()">
            <h4 mat-line>همه</h4>
          </a>

          <mat-divider></mat-divider>

          <a mat-list-item (click)="openCreateCandidateDialog()">
            <mat-icon mat-list-icon>add</mat-icon>
            <h4 mat-line>افزودن کارجو</h4>
          </a>

        </mat-nav-list>
      </div>
    </div>

    <div class="col-sm-10 table-col">
      <div [@.disabled]="expression" class="page">

        <mat-tab-group>
          <mat-tab label="مربوط به شما">
            <div class="row no-gutters table-content">
              <div class="col-sm-12">

                <div class="table-filter">

                  <span class="label"><mat-icon>filter_list</mat-icon>‌</span>
                  <span *ngIf="selection.selected.length > 0" class="selection-count">{{selection.selected.length | persianNumber}} کارجو</span>

                  <mat-form-field>
                    <input matInput
                           [(ngModel)]="searchKeyword"
                           (keyup)="applyFilterBySearch($event.target.value)" placeholder="کلمات کلیدی">
                  </mat-form-field>

                  <mat-form-field>
                    <mat-select placeholder="موقعیت شغلی"
                                [(ngModel)]="searchJobPosition"
                                (selectionChange)="applyFilterByJobPosition($event.value)">
                      <mat-option value="ALL">انتخاب کنید</mat-option>
                      <mat-option *ngFor="let items of jobList?.content" value="{{items.data.id}}">{{items.data.nameFa}}</mat-option>
                    </mat-select>
                  </mat-form-field>

                  <mat-form-field>
                    <mat-select placeholder="مرحله"
                                [(ngModel)]="searchPipeline"
                                (selectionChange)="applyFilterByPipeline($event.value)">
                      <mat-option value="ALL">انتخاب کنید</mat-option>
                      <mat-option *ngFor="let pipeline of companyPipeline" value="{{pipeline.data.id}}">{{pipeline.data.title}}</mat-option>
                    </mat-select>
                  </mat-form-field>

                  <button *ngIf="showClearFilter" (click)="clearFilter()" mat-raised-button>حذف فیلتر</button>

                </div>

                <table *ngIf="!isLoading && dataSourceRaw?.totalElements > 0" mat-table [dataSource]="dataSource">

                  <!-- Checkbox Column -->
                  <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                      <mat-checkbox (change)="$event ? masterToggle() : null"
                                    [checked]="selection.hasValue() && isAllSelected()"
                                    [indeterminate]="selection.hasValue() && !isAllSelected()">
                      </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let row">
                      <mat-checkbox (click)="$event.stopPropagation()"
                                    (change)="$event ? selection.toggle(row) : null"
                                    [checked]="selection.isSelected(row)">
                      </mat-checkbox>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="candidate">
                    <th mat-header-cell *matHeaderCellDef> کارجو </th>
                    <td mat-cell *matCellDef="let element">
                      <a href="...">{{element.data.firstName}}  {{element.data.lastName}}</a>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="owner">
                    <th mat-header-cell *matHeaderCellDef> کارفرما </th>
                    <td mat-cell *matCellDef="let element"> {{element.data.employer}} </td>
                  </ng-container>

                  <ng-container matColumnDef="createdDate">
                    <th mat-header-cell *matHeaderCellDef> تاریخ ایجاد </th>
                    <td mat-cell *matCellDef="let element"> {{element.data.createdDate | jalali}} </td>
                  </ng-container>

                  <ng-container matColumnDef="jobPosition">
                    <th mat-header-cell *matHeaderCellDef> موقعیت شغلی </th>
                    <td mat-cell *matCellDef="let element"> {{element.include.job.nameFa}} </td>
                  </ng-container>

                  <ng-container matColumnDef="companyPipeline">
                    <th mat-header-cell *matHeaderCellDef> مرحله </th>
                    <td mat-cell *matCellDef="let element">
                      <mat-form-field>
                        <mat-select [(value)]="'' + element.include.pipeline.id">
                          <mat-option *ngFor="let pipeline of companyPipeline" value="{{pipeline.data.id}}">{{pipeline.data.title}}</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                  </tr>
                </table>

                <div class="loading" *ngIf="isLoading"
                     style="display: flex; justify-content: center; align-items: center">
                  <mat-progress-spinner
                    color="primary"
                    mode="indeterminate"
                    [diameter]="50">
                  </mat-progress-spinner>
                </div>

                <div *ngIf="dataSourceRaw?.totalElements == 0" class="table-no-data">
                  <p>اطلاعاتی برای نمایش وجود ندارد</p>
                </div>

              </div>
            </div>

          </mat-tab>
          <mat-tab label="همه">
            <div class="row no-gutters">
              <div class="col-sm-12">
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>

      </div>
    </div>

  </div>

</div>
